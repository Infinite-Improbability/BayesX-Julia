<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Internals · BayesJ</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BayesJ</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../public/">Public</a></li><li class="is-active"><a class="tocitem" href>Internals</a><ul class="internal"><li><a class="tocitem" href="#Contents"><span>Contents</span></a></li><li><a class="tocitem" href="#Index"><span>Index</span></a></li><li><a class="tocitem" href="#Private-Interface"><span>Private Interface</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>Internals</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Internals</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/main/docs/src/private.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Internals"><a class="docs-heading-anchor" href="#Internals">Internals</a><a id="Internals-1"></a><a class="docs-heading-anchor-permalink" href="#Internals" title="Permalink"></a></h1><h2 id="Contents"><a class="docs-heading-anchor" href="#Contents">Contents</a><a id="Contents-1"></a><a class="docs-heading-anchor-permalink" href="#Contents" title="Permalink"></a></h2><ul><li><a href="#Internals">Internals</a></li><li class="no-marker"><ul><li><a href="#Contents">Contents</a></li><li><a href="#Index">Index</a></li><li><a href="#Private-Interface">Private Interface</a></li><li class="no-marker"><ul><li><a href="#Cluster-Models">Cluster Models</a></li><li><a href="#Constants">Constants</a></li><li><a href="#Emissions-Modelling">Emissions Modelling</a></li><li><a href="#IO">IO</a></li><li><a href="#Likelihood">Likelihood</a></li><li><a href="#Utilities">Utilities</a></li></ul></li></ul></li></ul><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#BayesJ.cosmo"><code>BayesJ.cosmo</code></a></li><li><a href="#BayesJ.μ"><code>BayesJ.μ</code></a></li><li><a href="#BayesJ.μ_e"><code>BayesJ.μ_e</code></a></li><li><a href="#BayesJ.Dataset"><code>BayesJ.Dataset</code></a></li><li><a href="#BayesJ.Ellipse"><code>BayesJ.Ellipse</code></a></li><li><a href="#BayesJ.Prior"><code>BayesJ.Prior</code></a></li><li><a href="#BayesJ.XS_Mekal"><code>BayesJ.XS_Mekal</code></a></li><li><a href="#BayesJ.apply_response_function-Union{Tuple{T}, Tuple{Vector{T}, Matrix{T}, T}} where T&lt;:AbstractFloat"><code>BayesJ.apply_response_function</code></a></li><li><a href="#BayesJ.bin_events-Tuple{FITSData, Vararg{Any, 4}}"><code>BayesJ.bin_events</code></a></li><li><a href="#BayesJ.bin_events-Tuple{PlaintextData, Any, Vararg{Any}}"><code>BayesJ.bin_events</code></a></li><li><a href="#BayesJ.call_mekal-Tuple{Any, Any, Any}"><code>BayesJ.call_mekal</code></a></li><li><a href="#BayesJ.load_data-Tuple{FITSData}"><code>BayesJ.load_data</code></a></li><li><a href="#BayesJ.load_data-Tuple{BayesJ.Dataset}"><code>BayesJ.load_data</code></a></li><li><a href="#BayesJ.load_data-Tuple{PlaintextData}"><code>BayesJ.load_data</code></a></li><li><a href="#BayesJ.load_events_from_fits-Tuple{AbstractString}"><code>BayesJ.load_events_from_fits</code></a></li><li><a href="#BayesJ.load_mask-Tuple{BayesJ.Dataset}"><code>BayesJ.load_mask</code></a></li><li><a href="#BayesJ.load_response-Tuple{BayesJ.Dataset, Any}"><code>BayesJ.load_response</code></a></li><li><a href="#BayesJ.load_response-Tuple{PlaintextData, Any}"><code>BayesJ.load_response</code></a></li><li><a href="#BayesJ.log_factorial-Tuple{N} where N&lt;:Integer"><code>BayesJ.log_factorial</code></a></li><li><a href="#BayesJ.log_likelihood-NTuple{5, Any}"><code>BayesJ.log_likelihood</code></a></li><li><a href="#BayesJ.make_cube_transform-Tuple{Vararg{BayesJ.Prior}}"><code>BayesJ.make_cube_transform</code></a></li><li><a href="#BayesJ.make_observation-Union{Tuple{T}, Tuple{A}, Tuple{Function, Function, Any, Any, A, Any, T, Any, Tuple{var&quot;#s259&quot;, var&quot;#s259&quot;} where var&quot;#s259&quot;&lt;:(Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}), Any}} where {A&lt;:(Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}), T&lt;:(Union{Unitful.Quantity{T, 𝐓, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐓, U}} where {L, S}} where {T, U})}"><code>BayesJ.make_observation</code></a></li><li><a href="#BayesJ.make_observation-Union{Tuple{T}, Tuple{A}, Tuple{Function, Function, Any, Any, A, Any, T, Any, Tuple{Real, Real}, Any}} where {A&lt;:(Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}), T&lt;:(Union{Unitful.Quantity{T, 𝐓, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐓, U}} where {L, S}} where {T, U})}"><code>BayesJ.make_observation</code></a></li><li><a href="#BayesJ.prepare_model_mekal-Union{Tuple{V}, Tuple{U}, Tuple{T}, Tuple{Union{Unitful.Quantity{T, 𝐋^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^-2, U}} where {L, S}} where {T, U}, AbstractRange{T}, Real}} where {T&lt;:(Union{Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}} where {L, S}} where {T, U}), U&lt;:(Union{Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}} where {L, S}} where {T, U}), V&lt;:(Union{Unitful.Quantity{T, 𝐋^-3, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^-3, U}} where {L, S}} where {T, U})}"><code>BayesJ.prepare_model_mekal</code></a></li><li><a href="#BayesJ.surface_brightness-Tuple{Union{Unitful.Quantity{T, 𝐋, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋, U}} where {L, S}} where {T, U}, Function, Function, Float64, Union{Unitful.Quantity{T, 𝐋, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋, U}} where {L, S}} where {T, U}, Any, Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}}"><code>BayesJ.surface_brightness</code></a></li><li><a href="#BayesJ.test_point"><code>BayesJ.test_point</code></a></li><li><a href="#BayesJ.transform-Tuple{BayesJ.Prior, Real}"><code>BayesJ.transform</code></a></li></ul><h2 id="Private-Interface"><a class="docs-heading-anchor" href="#Private-Interface">Private Interface</a><a id="Private-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Private-Interface" title="Permalink"></a></h2><h3 id="Cluster-Models"><a class="docs-heading-anchor" href="#Cluster-Models">Cluster Models</a><a id="Cluster-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Cluster-Models" title="Permalink"></a></h3><h3 id="Constants"><a class="docs-heading-anchor" href="#Constants">Constants</a><a id="Constants-1"></a><a class="docs-heading-anchor-permalink" href="#Constants" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="BayesJ.cosmo" href="#BayesJ.cosmo"><code>BayesJ.cosmo</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>Cosmology assumed by BayesX</p><p>Defaults to:</p><ul><li>h=0.69,</li><li>Neff=3.04,</li><li>OmegaK=0,</li><li>OmegaM=0.29,</li><li>OmegaR=nothing,</li><li>Tcmb=2.7255,</li><li>w0=-1,</li><li>wa=0</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/params.jl#L5-L17">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.μ" href="#BayesJ.μ"><code>BayesJ.μ</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>Mean mass per gas particle = 0.6mₚ</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/params.jl#L27">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.μ_e" href="#BayesJ.μ_e"><code>BayesJ.μ_e</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>Mean gas mass per electron = 1.14mₚ</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/params.jl#L30">source</a></section></article><h3 id="Emissions-Modelling"><a class="docs-heading-anchor" href="#Emissions-Modelling">Emissions Modelling</a><a id="Emissions-Modelling-1"></a><a class="docs-heading-anchor-permalink" href="#Emissions-Modelling" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="BayesJ.apply_response_function-Union{Tuple{T}, Tuple{Vector{T}, Matrix{T}, T}} where T&lt;:AbstractFloat" href="#BayesJ.apply_response_function-Union{Tuple{T}, Tuple{Vector{T}, Matrix{T}, T}} where T&lt;:AbstractFloat"><code>BayesJ.apply_response_function</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">apply_response_function(counts_per_bin::Vector, response::Matrix, exposure_time::Unitful.Time)::Vector{Float64}</code></pre><p>Applies the response function <span>$RSP(PI, E) = RMF(PI, E) ∘ ARF(E)$</span> to all energy bins and returns adjusted counts per bin.</p><p class="math-container">\[\begin{aligned}
C(PI) &amp;= T \int RMF(PI, E) ⋅ ARF(E) ⋅ S(E) ⋅ dE \\
&amp;≈ T \sum_{j} R_{ij} A{j} S{j}
\end{aligned}\]</p><p>with <code>C(PI)</code> is the observed counts in a detector channel <code>PI</code>, <code>T</code> is the observation time, <code>ARF(E)</code> is the effective area of the instrument and <code>RMF(E, PI)</code> [we use <code>RMF(PI, E)</code>] is the unitless response matrix. (Handbook of X-ray Astronomy Chapter 2011, Chapter 5 pg 87, by K. Arnaud, R. Smith and A. Siemiginowska)</p><p>This function takes the combined RMF and ARF as the response function. This is to recalculating it on every call. Some people format the RMF as RMF(E, PI), others as RMF(PI, E). This latter convention is used by CIAO and by us.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/emission.jl#L119-L135">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.make_observation-Union{Tuple{T}, Tuple{A}, Tuple{Function, Function, Any, Any, A, Any, T, Any, Tuple{Real, Real}, Any}} where {A&lt;:(Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}), T&lt;:(Union{Unitful.Quantity{T, 𝐓, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐓, U}} where {L, S}} where {T, U})}" href="#BayesJ.make_observation-Union{Tuple{T}, Tuple{A}, Tuple{Function, Function, Any, Any, A, Any, T, Any, Tuple{Real, Real}, Any}} where {A&lt;:(Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}), T&lt;:(Union{Unitful.Quantity{T, 𝐓, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐓, U}} where {L, S}} where {T, U})}"><code>BayesJ.make_observation</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Centre position is given in arcseconds.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/emission.jl#L245-L247">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.make_observation-Union{Tuple{T}, Tuple{A}, Tuple{Function, Function, Any, Any, A, Any, T, Any, Tuple{var&quot;#s259&quot;, var&quot;#s259&quot;} where var&quot;#s259&quot;&lt;:(Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}), Any}} where {A&lt;:(Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}), T&lt;:(Union{Unitful.Quantity{T, 𝐓, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐓, U}} where {L, S}} where {T, U})}" href="#BayesJ.make_observation-Union{Tuple{T}, Tuple{A}, Tuple{Function, Function, Any, Any, A, Any, T, Any, Tuple{var&quot;#s259&quot;, var&quot;#s259&quot;} where var&quot;#s259&quot;&lt;:(Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}), Any}} where {A&lt;:(Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}), T&lt;:(Union{Unitful.Quantity{T, 𝐓, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐓, U}} where {L, S}} where {T, U})}"><code>BayesJ.make_observation</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">make_observation(temperature, density, z, shape, pixel_edge_angle, emission_model, exposure_time, response_function, centre, centre_radius, mask=nothing)</code></pre><p>Generate an image of the cluster given functions for the radial profile of gas temperature and electron density and assorted observational parameters.</p><p><code>shape</code> describes the size of the source number as a number of spatial bins in each dimension. The pixel edge angle describes the angular size observed by a single pixel in units such as arcseconds. This area is assumed to be square with the edge angle giving the side length. The emission model should be a function compatible with the requirements of the <code>surface_brightness</code> function, which it will be passed to. The response function includes both the RMF and ARF, as described in <code>apply_response_function</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/emission.jl#L162-L172">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.surface_brightness-Tuple{Union{Unitful.Quantity{T, 𝐋, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋, U}} where {L, S}} where {T, U}, Function, Function, Float64, Union{Unitful.Quantity{T, 𝐋, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋, U}} where {L, S}} where {T, U}, Any, Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}}" href="#BayesJ.surface_brightness-Tuple{Union{Unitful.Quantity{T, 𝐋, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋, U}} where {L, S}} where {T, U}, Function, Function, Float64, Union{Unitful.Quantity{T, 𝐋, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋, U}} where {L, S}} where {T, U}, Any, Union{Unitful.Quantity{T, 𝐀, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐀, U}} where {L, S}} where {T, U}}"><code>BayesJ.surface_brightness</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">surface_brightness(projected_radius, temperature, density, z, limit, model, pixel_edge_angle)</code></pre><p>Calculate the observed surface_brightness at some projected radius on the sky.</p><p>The temperature and density functions should take the distance from origin (cluster centre) and return the appropriate value, with units.</p><p>The model should take these functions as input and return a vector of volume emissivities, where the vector element correspond with the energy bins used to generate the mode. It should include the effects of redshift on the bins and time dilation on the count rate.</p><p>The limit controls limits on LOS radius during integration. Theoretically it should be ±infinity, but we may approximate it as a finite value.</p><p>The pixel edge angle is the angular size of a single pixel.</p><p>The result returned is the expected count rate per unit observing area, as a vector corresponding to the energy bins as used in the model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/emission.jl#L7-L22">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.XS_Mekal" href="#BayesJ.XS_Mekal"><code>BayesJ.XS_Mekal</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Mekal model using SpectralFitting.jl framework. Kept around so we can borrow the model data downloading functions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/mekal.jl#L18">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.call_mekal-Tuple{Any, Any, Any}" href="#BayesJ.call_mekal-Tuple{Any, Any, Any}"><code>BayesJ.call_mekal</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">call_mekal(energy_range, temperature, nH)</code></pre><p>Given a unitful range of energy and unitless temperature (keV) and hydrogen density in the source (cm^-3) calls MEKAL to calculate the volume emissivity of the source in the source frame.</p><p>Due to performance concerns I recommend calling <code>prepare_model_mekal</code> instead to generate an interpolation over the model. The interpolation also implicitly includes absorption, which this function does not.</p><p><strong>Implementation Details</strong></p><p>The XSPEC and MEKAL documentation is at times short on detail. Here&#39;s what I&#39;ve figured out, mostly by inspecting the models in the XSPEC source code. The MEKA model has similar code and more extensive comments that MEKAL  that are very helpful.</p><p>The values calculated by MEKAL are multiplied by a constant of 2.53325e-3. Inspecting the MEKA comments we find the following equation for this constant which we will term <code>C</code></p><p class="math-container">\[C = √2 ⋅ h^2 ⋅ α^3 / ((3πm_e)^1.5 ⋅ √(1000e) ⋅ π ⋅ (1pc)^2 ⋅ 10^4)\]</p><p>and the instruction to use SI units. <code>h</code> appears to be Planck&#39;s constant (unreduced) and <code>α</code> the fine-structure constant. Calculating this gives C=2.533242122484874e-59 kg^1/2 m^2 A^-1/2 s^-5/2.</p><p>MEKAL adjusts emissions by what it terms <code>cem</code> which is the emitting volume divided by the square of distance to the volume. This follows naturally from the relationship between surface emissivity <code>σ</code> and volume emissivity <code>ϵ</code>.</p><p class="math-container">\[    σ = ϵV / (4πD)^2\]</p><p>MEKAL uses units of 1e50cm^3 / 1pc^2 for <code>cem</code>. If we multiply by 10^50cm^3 we get 2.533242122484874e-13 J^2 cm s^2 C^-1/2 kg^-3/2. As dividing by 1pc^2 would change more than just the magnitude of the value I assume it is folded in as the 1pc^2 in the original equation. Furthermore I assume that remaining difference rests in the details of units and implementation.</p><p>MEKAL states it outputs in phot/cm^2/s/keV. MEKA states the same but has an optional switch that instead outputs in phot/m^3/s/keV. It does this by replacing <code>C</code> with <code>D=3.03103E-9</code> which it states is derived so that</p><p class="math-container">\[C = D * 10^40 / (4π * 1pc^2)\]</p><p>I have verified this gives results matching that of doing the conversion manually (by dividing out 1e50cm^3 and multiplying by 1pc^2).</p><p>Attempts were made to invoke MEKAL through XSPEC&#39;s wrapper functions but I found the modifications they introduced were troublesome to work out, though some were necessary and are reimplemented in <code>surface_brightness</code>. MEKAL&#39;s operations are more clearly physically motivated.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/mekal.jl#L48-L89">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.prepare_model_mekal-Union{Tuple{V}, Tuple{U}, Tuple{T}, Tuple{Union{Unitful.Quantity{T, 𝐋^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^-2, U}} where {L, S}} where {T, U}, AbstractRange{T}, Real}} where {T&lt;:(Union{Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}} where {L, S}} where {T, U}), U&lt;:(Union{Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}} where {L, S}} where {T, U}), V&lt;:(Union{Unitful.Quantity{T, 𝐋^-3, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^-3, U}} where {L, S}} where {T, U})}" href="#BayesJ.prepare_model_mekal-Union{Tuple{V}, Tuple{U}, Tuple{T}, Tuple{Union{Unitful.Quantity{T, 𝐋^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^-2, U}} where {L, S}} where {T, U}, AbstractRange{T}, Real}} where {T&lt;:(Union{Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}} where {L, S}} where {T, U}), U&lt;:(Union{Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^2 𝐌 𝐓^-2, U}} where {L, S}} where {T, U}), V&lt;:(Union{Unitful.Quantity{T, 𝐋^-3, U}, Unitful.Level{L, S, Unitful.Quantity{T, 𝐋^-3, U}} where {L, S}} where {T, U})}"><code>BayesJ.prepare_model_mekal</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">prepare_model_mekal(nHcol, energy_bins, z; temperatures, hydrogen_densities, use_interpolation=true)</code></pre><p>Create an interpolated alias to the mekal model with photoelectric absorption over specified parameter ranges.</p><p>The interpolation object <code>(T::Unitful.Energy, nH::Unitful.𝐋^-3) -&gt; volume emissivity</code> returned gives the volume emissivity per bin of a source of the specified temperature and hydrogen number density with the effects of absorption from passage through an area with a hydrogen column density equal to that specified in the <code>prepare_model_mekal</code> call.</p><p>Applies redshift and time dilation.</p><p>Interpolation has a significant performance improvement over calling the model directly. No redshift is currently applied to energy bins - they should be assumed to be in the source frame. It may be wise to adjust this but then <code>surface_brightness</code> will need adjustment so it doesn&#39;t apply the correction twice.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/mekal.jl#L156-L171">source</a></section></article><h3 id="IO"><a class="docs-heading-anchor" href="#IO">IO</a><a id="IO-1"></a><a class="docs-heading-anchor-permalink" href="#IO" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="BayesJ.Dataset" href="#BayesJ.Dataset"><code>BayesJ.Dataset</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Abstract type to wrap various specific formats for source data. By doing so we can make use of     multiple dispatch to automatically select the appropriate loading functions for data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L11-L14">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.Ellipse" href="#BayesJ.Ellipse"><code>BayesJ.Ellipse</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Ellipse(x, y, r1, r2, θ)</code></pre><p>An ellipse centered at <code>(x, y)</code> with radii <code>r1</code> and <code>r2</code> and rotation <code>θ</code>.</p><p><code>r1</code> and <code>r2</code> are the width and height respectively with zero rotation and <code>θ</code> is defined as rotation counterclockwise from the x-axis in radians.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L277-L284">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.bin_events-Tuple{FITSData, Vararg{Any, 4}}" href="#BayesJ.bin_events-Tuple{FITSData, Vararg{Any, 4}}"><code>BayesJ.bin_events</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">bin_events(::FITSData, events, energy_range, x_edges, y_edges)</code></pre><p>Take a table of events in the format (x y channel energy), trim it by energy and bin it spatially. Returns an array of counts per bin with dimensions (channel, x, y).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L176-L181">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.bin_events-Tuple{PlaintextData, Any, Vararg{Any}}" href="#BayesJ.bin_events-Tuple{PlaintextData, Any, Vararg{Any}}"><code>BayesJ.bin_events</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">bin_events(::PlaintextData, events, ...)</code></pre><p>Placeholder function, returns events matrix without modification</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L260-L263">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.load_data-Tuple{BayesJ.Dataset}" href="#BayesJ.load_data-Tuple{BayesJ.Dataset}"><code>BayesJ.load_data</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">load_data(data)</code></pre><p>Load events data from a given dataset, returning pairs of events and exposure times.</p><p>The first pair includes all observed events, the second is the background observation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L35-L41">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.load_data-Tuple{FITSData}" href="#BayesJ.load_data-Tuple{FITSData}"><code>BayesJ.load_data</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">load_data(data::FITSData)</code></pre><p>Load data from FITS events files for the observation and background.</p><p>Exposure times are taken from the LIVETIME value in the header.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L90-L96">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.load_data-Tuple{PlaintextData}" href="#BayesJ.load_data-Tuple{PlaintextData}"><code>BayesJ.load_data</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">load_data(data::PlaintextData)</code></pre><p>Load data from plaintext files as generated by existing Bayes-X binning scripts.</p><p>Data is reshaped to the given size so should be provided in column-major order or in a matrix of correct size.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L227-L234">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.load_events_from_fits-Tuple{AbstractString}" href="#BayesJ.load_events_from_fits-Tuple{AbstractString}"><code>BayesJ.load_events_from_fits</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">load_events_from_fits(path)</code></pre><p>Loads events from a single fits file for further processing.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L65-L69">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.load_mask-Tuple{BayesJ.Dataset}" href="#BayesJ.load_mask-Tuple{BayesJ.Dataset}"><code>BayesJ.load_mask</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">load_mask()</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L270-L272">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.load_response-Tuple{BayesJ.Dataset, Any}" href="#BayesJ.load_response-Tuple{BayesJ.Dataset, Any}"><code>BayesJ.load_response</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">load_response(data, energy_range)</code></pre><p>Load the RMF and ARF for an observation, trimmed for the desired energy range</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L46-L50">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.load_response-Tuple{PlaintextData, Any}" href="#BayesJ.load_response-Tuple{PlaintextData, Any}"><code>BayesJ.load_response</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">load_response(data::PlaintextData, _)</code></pre><p>Load response matrix from plaintext files as generated by existing Bayes-X binning scripts.</p><p>Data is reshaped to the given size so should be provided in column-major order or as a matrix of correct size.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L241-L248">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.test_point" href="#BayesJ.test_point"><code>BayesJ.test_point</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">test_point(e::Ellipse, x, y, atol=0)</code></pre><p>Tests whether a point is within an ellipse with tolerance <code>atol</code>.</p><p>The equation for an ellipse in Cartesian coordinates is of the form <code>f(x,y) = 1</code>. We consider any point <code>(x0, y0)</code> such that <code>f(x0, y0) &lt;= 1 + atol</code> as being within the ellipse.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/io.jl#L293-L300">source</a></section></article><h3 id="Likelihood"><a class="docs-heading-anchor" href="#Likelihood">Likelihood</a><a id="Likelihood-1"></a><a class="docs-heading-anchor-permalink" href="#Likelihood" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="BayesJ.Prior" href="#BayesJ.Prior"><code>BayesJ.Prior</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Abstract supertype for priors. Should implement:</p><ul><li>A transform(prior, x) function that transforms a value x on the unit range to a value on the distribution represented by the prior.</li><li>A field <code>name&lt;:AbstractString</code> </li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/likelihood.jl#L62-L66">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.log_factorial-Tuple{N} where N&lt;:Integer" href="#BayesJ.log_factorial-Tuple{N} where N&lt;:Integer"><code>BayesJ.log_factorial</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">log_factorial(n)</code></pre><p>Finds <span>$\ln{n!}$</span> the natural logarithm of the factorial of <code>n</code>.</p><p><code>n</code> rapidly gets to large to quickly and directly calculate the factorial so we exploit logarithm rules to expand it out to a series of sums.</p><p>It is intended to be broadcast across all values of the data array.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/likelihood.jl#L50-L59">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.log_likelihood-NTuple{5, Any}" href="#BayesJ.log_likelihood-NTuple{5, Any}"><code>BayesJ.log_likelihood</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">log_likelihood(observed, observed_background, predicted, predicted_background, observed_log_factorial)</code></pre><p>Calculate the log-likelihood of the prediction given an observation.</p><p>The observed and predicted arrays include background events. Log factorial is calculated as <code>ln(observed) + ln(observed_background)</code>. We require it to be supplied to improve performance - no need to calculate it every time.</p><p>We assume the predicted_background is scaled to the same exposure time as the observed background.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/likelihood.jl#L5-L15">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.make_cube_transform-Tuple{Vararg{BayesJ.Prior}}" href="#BayesJ.make_cube_transform-Tuple{Vararg{BayesJ.Prior}}"><code>BayesJ.make_cube_transform</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">make_cube_transform(priors::Prior...)::NTuple{2, Function}</code></pre><p>Turn a sequence of prior transform functions into a transform function <code>transform_cube</code> that operates on the hypercube generated by multinest, stripping delta functions.</p><p>It also returns a function <code>reconstruct_args</code> take takes the output of the first function and returns it with the values of the delta priors inserted in appropriate postions.  This is because Ultranest can run with delta priors but outputs error warnings in the process.</p><p>Returns <code>transform_cube</code> and <code>reconstruct_args</code> as a tuple.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/likelihood.jl#L151-L162">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BayesJ.transform-Tuple{BayesJ.Prior, Real}" href="#BayesJ.transform-Tuple{BayesJ.Prior, Real}"><code>BayesJ.transform</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">transform(prior, x)</code></pre><p>Transforms a value x on the unit range to a value on the distribution represented by the prior.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Infinite-Improbability/BayesX-Julia/blob/10a54c109252abd400fe49d2b5257ce33a63e3f4/src/likelihood.jl#L69-L73">source</a></section></article><h3 id="Utilities"><a class="docs-heading-anchor" href="#Utilities">Utilities</a><a id="Utilities-1"></a><a class="docs-heading-anchor-permalink" href="#Utilities" title="Permalink"></a></h3></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../public/">« Public</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Sunday 20 August 2023 08:16">Sunday 20 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
